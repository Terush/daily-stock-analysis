# システム開発仕様書

プロジェクト名: 25MA Trend Follow Bot (商社版)

バージョン: 1.0

作成日: 2026年1月1日

## 1. 概要

本システムは、指定された商社銘柄（丸紅・三井物産など）の株価データを自動取得し、「25日移動平均線＋傾き判定」および「損切りルール」に基づいた売買シグナルを検知する。

シグナル発生時はユーザーへメール通知を行うと共に、現在の市場状況と判定結果をWebページとしてインターネット上に公開する。

## 2. システム構成

### 2.1 アーキテクチャ

- **実行環境:** ThinkPad X1 Carbon (Pop!_OS / Linux)
- **言語:** Python 3.x
- **データソース:** Yahoo Finance (`yfinance`)
- **通知:** SMTP (Gmail等のメールサーバーを経由)
- **Web公開:** GitHub Pages（静的ホスティング）
    - PythonスクリプトがHTMLを生成し、自動でGitHubへプッシュして公開する仕組みを採用（サーバー代無料・管理不要）。

### 2.2 処理フロー

1. **起動:** OSのスケジューラ（cron）により、市場が閉まった後（例: 毎日17:00）に起動。
2. **データ取得:** 対象4銘柄のデータを取得。
3. **判定:** 売買ロジックに基づきシグナル判定。
4. **通知:** 「買い」または「売り」シグナルがあればメール送信。
5. **Web更新:** HTMLファイルを生成し、GitHubへアップロード（公開）。

## 3. 機能要件

### 3.1 監視対象銘柄（ポートフォリオ）

以下の優先順位で監視を行う。

1. **8002.T 丸紅** (SSランク)
2. **8031.T 三井物産** (Sランク)
3. **8058.T 三菱商事** (Aランク)
4. **2768.T 双日** (Bランク)

### 3.2 判定ロジック（アルゴリズム）

- **買い条件 (AND条件):**
    1. 現在値 > 25日移動平均線
    2. 前日終値 <= 前日25日移動平均線（ゴールデンクロス）
    3. 25日移動平均線の傾きが「上向き」（当日MA > 前日MA）
- **売り条件 (OR条件):**
    1. **デッドクロス:** 現在値 < 25日移動平均線 かつ 前日終値 >= 前日25日移動平均線
    2. **損切り:** (現在値 - エントリー価格) / エントリー価格 <= -0.05 (-5%)
        - ※エントリー価格はローカルファイル（CSV/JSON）で管理する。

### 3.3 メール通知機能

- **送信条件:** 「買い推奨」または「売り推奨」が発生した場合のみ送信。待機時は送信しない。
- **宛先:** 指定されたメールアドレス。
- **件名:** 【重要】株売買シグナル通知 (2026/01/01)
- **本文:**
    - 該当銘柄名とコード
    - シグナルの種類（買い/売り）
    - 現在価格と移動平均線の値
    - 具体的なアクション（例：「明日朝、成行で買ってください」）

### 3.4 Webページ公開機能

- **更新頻度:** 1日1回（バッチ処理時）。
- **表示内容:**
    - 最終更新日時
    - 4銘柄のステータス一覧（銘柄名、現在値、トレンド判定、シグナル有無）
    - 資産状況（現在の手持ち資金、保有株の評価額 ※オプション）
- **実装方法:** Pythonの `jinja2` テンプレートエンジン等を使用し、`index.html` を生成。自動的に `git commit` & `git push` を行う。

## 4. データ構造

### 4.1 設定・状態管理 (`portfolio_status.json`)

現在の保有状況を記録するファイル。

JSON

`{
  "last_updated": "2026-01-01 17:00:00",
  "cash": 30000,
  "holdings": {
    "8002.T": {
      "shares": 0,
      "entry_price": 0,
      "date_bought": null
    }
  }
}`

## 5. 画面・出力イメージ

### 5.1 メール通知

Plaintext

`件名: 【シグナル点灯】丸紅(8002)に買いサイン

本日の市場が終了しました。以下のシグナルが出ています。

■ 丸紅 (8002.T)
判定: 買い推奨 🚀
理由: ゴールデンクロス達成 ＆ 傾き上向き
現在値: 2,450円
25MA: 2,400円

【アクション】
明日の寄り付き（9:00）に「成行」で購入してください。`

### 5.2 公開Webページ

シンプルで視認性の高いダッシュボード形式。

| **銘柄** | **現在値** | **25MA** | **トレンド** | **今日の判定** |
| --- | --- | --- | --- | --- |
| **丸紅** | 2,450 | 2,400 | ↗ 上昇 | **BUY** 🔴 |
| **三井物産** | 3,100 | 3,150 | ↘ 下落 | WAIT |
| **三菱商事** | 2,800 | 2,750 | ↗ 上昇 | WAIT |
| **双日** | 3,500 | 3,500 | → 横ばい | WAIT |

---

## 6. 開発環境・ディレクトリ構成

Plaintext

`~/trade_bot/
├── main.py             # メイン実行スクリプト
├── config.py           # 設定（銘柄リスト、定数）
├── .env                # 環境変数（メールパスワード等 ※Git管理外）
├── portfolio_status.json # 保有状況データ
├── templates/
│   └── index.html      # Webページのテンプレート
└── docs/               # GitHub Pages公開用フォルダ
    └── index.html      # 自動生成されるWebページ`

## 7. セキュリティ対策

- **認証情報の保護:** Gmailのアプリパスワードなどの機密情報は、スクリプト内に直接書かず、`.env` ファイルで管理し、Gitにはアップロードしない（`.gitignore`に記述）。
